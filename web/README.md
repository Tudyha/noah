# 现代化企业级前端项目需求文档

## 1. 项目概述
- 目标：构建安全、稳定、可扩展的企业级前端应用，支持基础角色权限。
- 范围：运营管理后台、业务工作台、公共门户与组件库。
- 成功指标：首屏可用 < 2s、关键交互 < 100ms、Lighthouse ≥ 90。

## 2. 用户与角色
- 超级管理员：全局配置与审计。
- 业务用户：日常业务处理与数据查看。
- 访客/外部用户：有限访问与自助服务。

## 3. 核心功能需求
- 认证与授权：OIDC/OAuth2、企业 SSO、MFA、会话管理、基础角色权限、审计日志。
- 用户与组织：组织架构树、岗位与角色、成员批量导入导出。
- 仪表盘与报表：可配置卡片与图表、筛选联动、数据导出（CSV/XLSX/PDF）。
- 列表与详情：分页/排序/筛选/搜索、批量操作、标签与备注、变更历史。
- 表单：复杂表单校验、草稿/提交/撤回。
- 通知中心：站内消息、邮箱、短信、推送；消息模板与偏好设置。
- 文件与资源：上传/预览/版本控制、基础访问控制、病毒扫描与合规校验。
- 国际化与本地化：多语言、时区与货币格式、数字与日期本地化。
- 可观测性：错误上报、性能监测、行为埋点、关键路径追踪。
- 帮助与反馈：新手引导、内嵌使用手册、工单/反馈收集与跟踪。

## 4. 非功能性需求
- 性能：首屏 < 2s、TTI < 3s、交互 < 100ms、离线缓存关键资源、代码拆分与按需加载。
- 可用性与可访问性：响应式（≥ 360px 至 1920px）、适配高分屏、WCAG 2.1 AA。
- 安全：XSS/CSRF/点击劫持防护、CSP、依赖风险管控、敏感数据脱敏与加密、合规（GDPR/ISO）。
- 稳定性：错误隔离与降级、重试与回退策略、断网与弱网适配。
- 可维护性：模块化/组件化、统一代码规范与提交规范、可测试性与覆盖率目标（≥ 80%）。

## 5. 技术栈与架构
- 前端框架：Vue 3（Composition API）+ TypeScript + Vite。
- 路由与状态：Vue Router + Pinia，支持路由级权限与持久化。
- UI 与样式：Tailwind CSS + daisyUI，暗色/浅色主题与品牌定制。
- 网络与数据：REST/GraphQL；Axios/Fetch；全局拦截器、错误模型与重试。
- 实时能力：WebSocket/SSE 用于通知与实时状态更新。
- 国际化：vue-i18n，基于命名空间的文案管理与动态加载。
- 可视化：ECharts/Chart.js；统一图表组件封装与可配置能力。
- 质量保障：ESLint、Prettier、Husky、Commitlint、单测（Vitest）、端到端（Playwright）。
- 架构原则：分层架构（视图/业务/数据/基础设施）、可插拔模块与微前端（按需）。

## 6. 设计系统与 UI 规范
- 设计令牌：颜色、字号、间距、阴影、圆角统一管理，支持主题切换。
- 组件规范：表单、表格、卡片、导航、弹窗等统一交互与可访问性约定。
- 表单体验：联动、依赖校验、草稿与自动保存、占位与错误提示一致性。
- 动效与反馈：过渡与动效适度使用，关键操作明确反馈（加载、成功、失败）。

## 7. 数据契约与接口约定
- 版本策略：`/api/v{n}` 分层演进，旧版平滑兼容与弃用计划。
- 错误模型：统一错误码与字段（`code`/`message`/`details`），可定位与可恢复。
- 查询约定：分页（`page`/`pageSize`）、排序（`sortBy`/`order`）、筛选（`filters`）。
- 序列化约定：时间统一 ISO8601、数值与金额精度、枚举稳定与文档化。
- 上传下载：分片上传、断点续传、并发与限速策略，导出任务异步与通知。

## 8. 认证与路由保护（基础）
- 模型：基于会话的路由保护与资源访问校验。
- 路由与菜单：基于登录态与能力标识控制；未授权回退与提示。
- 暂不支持数据级权限与条件策略，后续里程碑评估。

## 9. 国际化
- 国际化：语言包动态加载、文案审核流程、区域/时区/货币适配。

## 10. DevOps 与交付流程
- 分支策略：`main`（发布）、`develop`（集成）、`feature/*`（特性）、`hotfix/*`（修复）。
- CI/CD：安装、构建、测试、质量门禁（Lint/覆盖率/大小），多环境部署（dev/staging/prod）。
- 环境配置：基于 `.env` 前缀白名单注入，敏感配置不落地前端仓库。
- 版本与发布：语义化版本、变更日志、灰度发布与回滚策略。

## 11. 可观测性与监控
- 前端监控：JS 错误、资源异常、性能指标（LCP/FID/CLS/TTI）。
- 埋点与日志：PV/UV、事件追踪、漏斗分析、关键链路监控与告警。
- 接口质量：成功率、耗时分布、超时与重试、降级命中统计。

## 12. 风险与合规
- 隐私与数据：最小化收集、用户同意与撤回、数据保留与删除机制。
- 法规与标准：GDPR、ISO27001、OWASP ASVS，对应技术与流程保障。

## 13. 验收标准
- 功能验收：用例覆盖核心流程，边界与异常场景可预测与可恢复。
- 性能与可用性：满足目标指标；移动与桌面一致体验；可访问性评审通过。
- 安全与合规：渗透测试与依赖审计通过；审计与日志完整性验证。
- 文档与培训：架构说明、开发规范、运维手册、用户手册与培训材料。

## 14. 里程碑与计划（示例）
- M1 原型：核心框架搭建、登录与基础路由、设计系统雏形（2 周）。
- M2 核心功能：列表/详情/表单、仪表盘、国际化（4 周）。
- M3 稳定与安全：基础权限与安全加固、监控与埋点、性能优化、测试覆盖（3 周）。
- M4 发布与推广：灰度与回滚、文档与培训、上线运营（2 周）。

## 15. 附录与术语
- 术语表：RBAC、SLO/SLA、OIDC、TTI、WCAG、CSP 等。
- 参考资料：设计系统与前端工程化最佳实践、行业合规指南。

## 16. 项目架构与目录说明
- 架构分层：
  - 界面层：`views`/`components`，以组合式组件为主，无业务耦合。
  - 路由层：`router`，路由配置与守卫，按角色控制可见性（基础 RBAC）。
  - 状态层：`stores`（Pinia），统一状态与缓存策略，持久化按需启用。
  - 服务层：`services`，HTTP/GraphQL 调用、错误模型与重试、数据映射。
  - 领域与类型：`types` 定义领域模型与接口契约，维持类型稳定。
  - 工具层：`utils` 通用工具函数，纯函数、无副作用。
  - 样式与设计系统：`style.css` + Tailwind CSS + daisyUI，统一设计令牌与主题。
- 数据流与边界：
  - 单向数据流：组件 → 状态（Pinia）→ 服务（API）→ 状态 → 组件。
  - 组件不直接调用底层 HTTP，仅通过服务层；服务层不持久 UI 状态。
- 错误与重试：
  - 统一错误模型（`code/message/details`），可重试与可降级策略在服务层实现。
  - 关键路径失败提供回退 UI 与提示，记录审计日志与上报。
- 权限与路由（基础）：
  - 基于登录态与能力标识控制菜单与路由；未授权访问统一回退。
  - 暂不实现数据级权限与条件策略，后续里程碑评估。
- 主题与样式：
  - 使用 Tailwind 原子化样式与 daisyUI 主题，支持暗色/浅色与品牌色定制。
  - 设计令牌驱动的尺寸/颜色/间距统一管理。
- 构建与配置：
  - Vite 插件：`@vitejs/plugin-vue`、`@tailwindcss/vite`，按需代码拆分与资源优化。
  - 环境变量通过 `.env` 白名单注入，敏感配置不进入前端仓库。

### 目录结构（当前与建议）

```
web/
├─ src/
│  ├─ assets/                 # 静态资源（图标、图片）
│  ├─ components/             # 通用组件（可按需创建）
│  ├─ views/                  # 页面级组件（可按需创建）
│  ├─ router/                 # 路由配置与守卫（可按需创建）
│  ├─ stores/                 # Pinia 状态（可按需创建）
│  ├─ services/               # 接口与业务服务（可按需创建）
│  ├─ utils/                  # 工具函数（可按需创建）
│  ├─ types/                  # TS 类型与领域模型（可按需创建）
│  ├─ App.vue                 # 应用根组件
│  ├─ main.ts                 # 入口文件，注册路由/状态/样式
│  └─ style.css               # Tailwind 与 daisyUI 样式入口
├─ public/                    # 静态公共资源
├─ index.html                 # SPA 模板页面
├─ vite.config.ts             # Vite 配置与插件
├─ package.json               # 依赖与脚本
├─ tsconfig*.json             # TypeScript 配置
└─ .vscode/                   # 编辑器建议配置
```

- 目录约定：
  - `components` 与 `views` 按业务域分组，避免巨型目录；组件命名统一前缀与规范。
  - `services` 按资源域拆分（如 `userService`/`orderService`），统一错误与重试策略。
  - `stores` 将可共享状态抽离，避免跨组件隐式耦合，持久化按需。
  - `types` 作为数据契约单一事实来源，避免散落定义。
  - 引入新目录前评估可维护性与复用性，遵循最小必要原则。

## 17. 技术设计文档
- 总体架构：
  - 前端单页应用（SPA），Vue3 + TypeScript + Vite，基础 RBAC。
  - 分层：界面（`views/components`）→ 路由（`router`）→ 状态（`stores`）→ 服务（`services`）→ 后端。
- 模块划分：
  - 认证模块：登录/登出、会话管理、用户信息获取。
  - 仪表盘模块：卡片/图表配置、数据源绑定与筛选联动。
  - 列表与详情模块：通用列表组件、分页/排序/筛选、详情视图与历史记录。
  - 表单模块：复杂校验、草稿/提交/撤回、动态表单与联动。
  - 通知模块：站内消息中心、消息模板与偏好设置。
  - 国际化模块：语言包管理、命名空间与懒加载。

- 路由设计：
  - 结构：顶层使用布局路由（`/`），子路由按模块划分（如 `/dashboard`、`/users`）。
  - 元信息：`meta.title`、`meta.requiresAuth`、`meta.keepAlive`、`meta.icon`。
  - 守卫：全局前置守卫校验会话；未登录跳转 `/login`；未授权回退 `/403`。
  - 代码拆分：路由组件动态导入，按路由维度分包。

- 状态管理（Pinia）：
  - `authStore`：`token`、`user`、`isAuthenticated`；提供 `login/logout/fetchUser`。
  - `uiStore`：`theme`、`locale`、`sidebarCollapsed`、消息未读数等。
  - `cacheStore`：列表查询缓存（键：查询条件；值：结果与过期时间）。
  - 持久化策略：仅持久化必要的 UI 偏好与会话信息（遵循隐私与安全）。

- 服务层设计：
  - `httpClient`：基于 `fetch` 的封装，统一 `baseURL`、头信息、超时与取消、JSON 序列化。
  - 拦截：请求自动附加会话令牌；响应统一解析错误模型（`code/message/details`）。
  - 重试：对幂等请求（GET）按指数退避重试；业务可配置最大重试次数与条件。
  - 资源服务：`userService`、`dashboardService`、`noticeService`。

- 错误与异常处理：
  - 全局错误处理器：Vue 应用级 `app.config.errorHandler`，上报并用户友好提示。
  - 组件级降级：关键组件提供占位与重试按钮；网络错误与权限错误区分提示。
  - 日志与审计：前端关键操作记录（非敏感），与后端审计对齐。

- 认证与路由保护：
  - 前端控制：路由 `meta.requiresAuth` 控制访问；菜单按登录态过滤；组件可见性基于登录态或能力字段。
  - 后端兜底：所有接口进行二次校验，防止前端绕过。

- 国际化设计：
  - `vue-i18n`，命名空间按模块划分（`dashboard`/`users`/`common`）。
  - 懒加载语言包：路由进入时按需加载对应命名空间文件。
  - 统一格式：日期/数字/货币格式通过工具层封装，避免散落逻辑。

- UI 设计系统：
  - Tailwind + daisyUI 主题，支持暗色/浅色及品牌色切换。
  - 通用组件：按钮、输入、选择、表格、分页、卡片、模态、Toast 等。
  - 表单校验：统一校验器（如自定义规则），错误展示一致化与可访问性。

- 数据模型与接口契约：
  - 用户：`User { id, name, email, status, createdAt }`
  - 通知：`Notice { id, type, title, content, status, createdAt }`
  - 错误：`Error { code, message, details? }`
  - 分页响应：`Page<T> { items: T[], page, pageSize, total }`

- 列表/详情/表单模式：
  - 列表：服务端分页与排序；筛选条件保持与分享（URL Query）。
  - 详情：只读视图 + 变更历史时间线；异常时提供刷新与重试。
  - 表单：复杂联动、动态字段、草稿保存（本地/远端）、提交与撤回；失败时保留用户输入。

- 仪表盘与报表：
  - 卡片系统：标准化卡片容器与图表组件，配置化数据源与查询。
  - 导出：异步导出任务与通知提醒；支持 CSV/XLSX/PDF（前端触发，后端生成）。

- 通知中心：
  - 通道：站内消息为主，邮箱/短信由后端网关统一处理；前端提供模板预览。
  - 设置：用户偏好（免打扰、订阅开关）；未读数在 `uiStore` 持久化。
  - 实时：可选 WebSocket/SSE 接入，降级为轮询。

- （移除）

- （移除）

- 性能优化策略：
  - 代码分包：路由与模块级动态导入；第三方库按需加载。
  - 资源优化：图片懒加载、SVG 优先、CDN 与缓存策略、预加载关键资源。
  - 数据优化：列表查询去抖与合并；客户端缓存与过期策略；并发控制。

- 安全策略：
  - XSS/CSRF/点击劫持防护，配置 CSP；输入与输出严格转义与白名单。
  - 会话：令牌最小暴露，首选 HttpOnly Cookie（若后端支持）；本地存储需加过期与轮换。
  - 依赖安全：定期审计与升级；敏感信息不写入前端仓库。

- 构建与配置：
  - 环境：`VITE_` 前缀注入白名单；按环境（dev/staging/prod）生成不同构建产物。
  - 构建：Vite 插件配置统一；生产构建启用压缩与指纹。
  - 质量门禁：Lint、类型检查与体积阈值校验。

- 测试策略：
  - 单元测试：组件与工具函数（Vitest）；服务层模拟接口与错误。
  - 端到端：关键用户路径（登录、列表查询、表单提交、通知查看）（Playwright）。
  - 覆盖率：≥ 80%，对核心模块与错误处理重点覆盖。

- 部署与发布：
  - CI/CD：安装 → 构建 → 测试 → 质量门禁 → 部署；多环境与灰度策略。
  - 版本：语义化版本与变更日志；出现严重问题支持快速回滚。

- 迁移与扩展：
  - 权限进阶：后续可评估引入 ABAC 与数据级权限。
  - 多租户：在后端与网关支持后评估前端隔离方案（主题/配置/域名）。

- 里程碑到技术任务映射：
  - M1：搭建项目骨架、登录页面与路由守卫、设计系统初版。
  - M2：通用列表/详情/表单组件、仪表盘模块与国际化落地。
  - M3：基础权限完善、监控与埋点接入、性能与测试优化。
  - M4：发布流程与回滚方案、文档完善与培训材料输出。